(function ($) {    var id_upld;    var img_ids = '';    var frame;    var popupImage = {        /**         * Handle a single selected image attachment         *         * @param attachment         */        updateImage: function (attachment) {            // the selected image            var image = attachment.toJSON();            // get image sizes data            var sizes = attachment.get('sizes');            if(typeof sizes !== 'undefined')            {                var size = ( typeof sizes.thumbnail === 'undefined' ) ? sizes.full : sizes.thumbnail;                img_ids += image.id + ',';                //image.id                $('#' + id_upld).val(img_ids);                //sizes.thumbnail.url                $('.plupload-attach').append("<img class='taxonomy-term-image-attach' src='" + size.url + "' />");                frame.close();            }        },        /**         * Remove the current image by emptying the container and field         */        removeImage: function () {            $(this).parent().remove();            jQuery('.images_order').attr('name', 'images_order[]');        },    }    // Build the choose from library frame.    $(document).on('click', '.modal-upload-btn', function (event) {        var $el = $(this);        event.preventDefault();        // If the media frame already exists, reopen it.        if ( frame ) {            frame.open();            return;        }        // Create the media frame.        frame = wp.media.frames.customHeader = wp.media({            // Set the title of the modal.            title: $el.data('choose'),            // Tell the modal to show only images.            library: {                type: 'image'            },            multiple: true,  // Set to true to allow multiple files to be selected            // Customize the submit button.            button: {                // Set the text of the button.                text: $el.data('update'),                // Tell the button not to close the modal, since we're                // going to refresh the page when the image is selected.                close: false            }        });        // When an image is selected, run a callback.        frame.on( 'select', function() {            frame.state()                .get('selection')                // handle each attachment                .map(popupImage.updateImage);        });        frame.on('open',function() {            var selection = frame.state().get('selection');            ids = jQuery('#'+ id_upld).val().split(',');            ids.forEach(function(id) {                attachment = wp.media.attachment(id);                attachment.fetch();                selection.add( attachment ? [ attachment ] : [] );            });        });        frame.open();    });    $(document).ready(function () {        id_upld = $('#pim_upload_id').val() ? $('#pim_upload_id').val() : 'pim_images';        $('.modal-remove-btn').click(popupImage.removeImage);    });})(jQuery);